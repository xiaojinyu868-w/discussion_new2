<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¼šè®®å¿«ç…§ - Meeting Snapshot | AI é©±åŠ¨çš„å®æ—¶ä¼šè®®æ´å¯Ÿ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-card: rgba(255, 255, 255, 0.03);
      --bg-card-hover: rgba(255, 255, 255, 0.06);
      --border-subtle: rgba(255, 255, 255, 0.08);
      --border-active: rgba(99, 102, 241, 0.5);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-muted: rgba(255, 255, 255, 0.4);
      --accent-primary: #6366f1;
      --accent-secondary: #8b5cf6;
      --accent-tertiary: #ec4899;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --gradient-hero: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
      --gradient-card: linear-gradient(180deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%);
      --shadow-glow: 0 0 60px rgba(99, 102, 241, 0.3);
      --shadow-card: 0 4px 24px rgba(0, 0, 0, 0.4);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 20px;
      --radius-xl: 28px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Inter', 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Ambient Background */
    .ambient-bg { position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden; }
    .ambient-orb { position: absolute; border-radius: 50%; filter: blur(100px); opacity: 0.4; animation: float 20s ease-in-out infinite; }
    .orb-1 { width: 600px; height: 600px; background: var(--accent-primary); top: -200px; left: -200px; }
    .orb-2 { width: 500px; height: 500px; background: var(--accent-secondary); top: 50%; right: -150px; animation-delay: -7s; }
    .orb-3 { width: 400px; height: 400px; background: var(--accent-tertiary); bottom: -100px; left: 30%; animation-delay: -14s; }
    @keyframes float { 0%, 100% { transform: translate(0, 0) scale(1); } 33% { transform: translate(30px, -30px) scale(1.05); } 66% { transform: translate(-20px, 20px) scale(0.95); } }

    .container { position: relative; z-index: 1; max-width: 1400px; margin: 0 auto; padding: 0 24px; }

    /* Navigation */
    .nav { position: fixed; top: 0; left: 0; right: 0; z-index: 100; padding: 20px 0; background: rgba(10, 10, 15, 0.8); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border-subtle); transition: all 0.3s ease; }
    .nav.scrolled { padding: 12px 0; background: rgba(10, 10, 15, 0.95); }
    .nav-inner { display: flex; align-items: center; justify-content: space-between; max-width: 1400px; margin: 0 auto; padding: 0 24px; }
    .logo { display: flex; align-items: center; gap: 12px; font-size: 1.5rem; font-weight: 700; background: var(--gradient-hero); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .logo-icon { width: 40px; height: 40px; background: var(--gradient-hero); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; -webkit-text-fill-color: white; }
    .nav-links { display: flex; gap: 32px; }
    .nav-link { color: var(--text-secondary); text-decoration: none; font-weight: 500; transition: color 0.2s ease; }
    .nav-link:hover { color: var(--text-primary); }
    .nav-cta { padding: 10px 24px; background: var(--gradient-hero); border: none; border-radius: var(--radius-md); color: white; font-weight: 600; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; }
    .nav-cta:hover { transform: translateY(-2px); box-shadow: var(--shadow-glow); }

    /* Hero */
    .hero { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 120px 24px 80px; }
    .hero-badge { display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 100px; font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 32px; animation: fadeInUp 0.8s ease; }
    .hero-badge-dot { width: 8px; height: 8px; background: var(--success); border-radius: 50%; animation: pulse 2s ease-in-out infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } }
    .hero-title { font-size: clamp(3rem, 8vw, 5.5rem); font-weight: 800; line-height: 1.1; margin-bottom: 24px; animation: fadeInUp 0.8s ease 0.1s backwards; }
    .hero-title-gradient { background: var(--gradient-hero); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .hero-subtitle { font-size: clamp(1.125rem, 2vw, 1.5rem); color: var(--text-secondary); max-width: 600px; margin-bottom: 48px; animation: fadeInUp 0.8s ease 0.2s backwards; }
    .hero-actions { display: flex; gap: 16px; flex-wrap: wrap; justify-content: center; animation: fadeInUp 0.8s ease 0.3s backwards; }
    .btn { display: inline-flex; align-items: center; gap: 8px; padding: 16px 32px; border-radius: var(--radius-md); font-size: 1rem; font-weight: 600; text-decoration: none; cursor: pointer; transition: all 0.3s ease; border: none; }
    .btn-primary { background: var(--gradient-hero); color: white; box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4); }
    .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 8px 30px rgba(99, 102, 241, 0.5); }
    .btn-secondary { background: var(--bg-card); color: var(--text-primary); border: 1px solid var(--border-subtle); }
    .btn-secondary:hover { background: var(--bg-card-hover); border-color: var(--border-active); }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

    /* Alert Banner */
    .alert-banner { background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(245, 158, 11, 0.2)); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-lg); padding: 20px 28px; margin-bottom: 32px; display: none; }
    .alert-banner.show { display: block; animation: fadeInUp 0.5s ease; }
    .alert-banner-title { font-weight: 600; color: #fca5a5; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
    .alert-banner-content { color: var(--text-secondary); font-size: 0.9375rem; line-height: 1.7; }
    .alert-banner-content code { background: rgba(0,0,0,0.3); padding: 2px 8px; border-radius: 4px; font-family: 'SF Mono', monospace; font-size: 0.875rem; }
    .alert-banner-content a { color: var(--accent-primary); }

    /* Demo Section */
    .demo-section { padding: 100px 0; }
    .section-header { text-align: center; margin-bottom: 60px; }
    .section-label { display: inline-block; padding: 6px 14px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 100px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; color: var(--accent-primary); margin-bottom: 16px; }
    .section-title { font-size: clamp(2rem, 4vw, 3rem); font-weight: 700; margin-bottom: 16px; }
    .section-desc { color: var(--text-secondary); max-width: 600px; margin: 0 auto; }

    /* Demo Container */
    .demo-container { background: var(--bg-secondary); border: 1px solid var(--border-subtle); border-radius: var(--radius-xl); overflow: hidden; box-shadow: var(--shadow-card); }
    .demo-toolbar { display: flex; align-items: center; justify-content: space-between; padding: 16px 24px; background: rgba(0, 0, 0, 0.3); border-bottom: 1px solid var(--border-subtle); }
    .demo-toolbar-dots { display: flex; gap: 8px; }
    .demo-toolbar-dot { width: 12px; height: 12px; border-radius: 50%; }
    .dot-red { background: #ff5f57; } .dot-yellow { background: #febc2e; } .dot-green { background: #28c840; }
    .demo-toolbar-title { font-size: 0.875rem; color: var(--text-muted); }
    .demo-toolbar-status { display: flex; align-items: center; gap: 8px; font-size: 0.875rem; }
    .status-indicator { width: 8px; height: 8px; border-radius: 50%; background: var(--text-muted); }
    .status-indicator.connected { background: var(--success); animation: pulse 2s ease-in-out infinite; }
    .status-indicator.error { background: var(--error); }
    .demo-content { display: grid; grid-template-columns: 1fr 400px; min-height: 600px; }
    @media (max-width: 1024px) { .demo-content { grid-template-columns: 1fr; } }

    /* Main Panel */
    .main-panel { padding: 32px; display: flex; flex-direction: column; gap: 24px; }
    .recording-card { background: var(--gradient-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 32px; }
    .recording-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    .recording-title { font-size: 1.5rem; font-weight: 700; }
    .recording-status { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 100px; font-size: 0.875rem; color: var(--success); }
    .recording-status.idle { background: rgba(255, 255, 255, 0.05); border-color: var(--border-subtle); color: var(--text-muted); }
    .recording-status.recording { background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3); color: var(--error); }
    .recording-timer { font-size: 4rem; font-weight: 300; font-variant-numeric: tabular-nums; margin-bottom: 8px; }
    .recording-hint { color: var(--text-muted); font-size: 0.875rem; margin-bottom: 24px; }
    .waveform-container { height: 80px; background: rgba(0, 0, 0, 0.2); border-radius: var(--radius-md); margin-bottom: 24px; overflow: hidden; position: relative; }
    .waveform { display: flex; align-items: center; justify-content: center; height: 100%; gap: 3px; padding: 0 20px; }
    .waveform-bar { width: 4px; background: var(--accent-primary); border-radius: 2px; transition: height 0.1s ease; }
    .recording-controls { display: flex; gap: 16px; }
    .record-btn { flex: 1; padding: 18px 32px; border: none; border-radius: var(--radius-md); font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .record-btn-primary { background: var(--gradient-hero); color: white; }
    .record-btn-primary:hover { transform: scale(1.02); box-shadow: var(--shadow-glow); }
    .record-btn-primary.recording { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
    .record-btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .record-btn-secondary { background: var(--bg-card); color: var(--text-secondary); border: 1px solid var(--border-subtle); }
    .record-btn-secondary:hover { background: var(--bg-card-hover); }
    .record-btn-secondary:disabled { opacity: 0.5; cursor: not-allowed; }

    /* Upload Card */
    .upload-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 20px 24px; margin-top: 20px; }
    .upload-header { display: flex; justify-content: space-between; align-items: center; gap: 12px; margin-bottom: 12px; }
    .upload-title { font-size: 1.1rem; font-weight: 700; }
    .upload-hint { color: var(--text-muted); font-size: 0.9rem; margin-top: 6px; }
    .upload-actions { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    .upload-input { flex: 1; min-width: 220px; color: var(--text-primary); }
    .upload-meeting { flex: 1; min-width: 200px; padding: 10px 12px; background: rgba(255,255,255,0.04); border: 1px solid var(--border-subtle); border-radius: 10px; color: var(--text-primary); }
    .upload-status { padding: 6px 12px; border-radius: 999px; font-size: 0.9rem; border: 1px solid var(--border-subtle); color: var(--text-muted); }
    .upload-status.loading { color: var(--warning); border-color: var(--warning); }
    .upload-status.success { color: var(--success); border-color: var(--success); }
    .upload-status.error { color: var(--error); border-color: var(--error); }

    /* Transcription Panel */
    .transcription-panel { flex: 1; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); display: flex; flex-direction: column; overflow: hidden; min-height: 300px; }
    .panel-header { display: flex; align-items: center; justify-content: space-between; padding: 20px 24px; border-bottom: 1px solid var(--border-subtle); }
    .panel-tabs { display: flex; gap: 4px; background: rgba(0, 0, 0, 0.2); padding: 4px; border-radius: var(--radius-md); }
    .panel-tab { padding: 10px 20px; border: none; background: transparent; color: var(--text-muted); font-size: 0.875rem; font-weight: 500; cursor: pointer; border-radius: var(--radius-sm); transition: all 0.2s ease; }
    .panel-tab.active { background: var(--accent-primary); color: white; }
    .panel-tab:hover:not(.active) { color: var(--text-primary); }
    .panel-content { flex: 1; overflow-y: auto; padding: 20px 24px; }
    .transcript-item { padding: 16px; background: rgba(0, 0, 0, 0.2); border-radius: var(--radius-md); margin-bottom: 12px; border-left: 3px solid var(--accent-primary); }
    .transcript-time { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 6px; }
    .transcript-text { color: var(--text-primary); line-height: 1.6; }
    .empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: var(--text-muted); text-align: center; padding: 40px; }
    .empty-state-icon { font-size: 3rem; margin-bottom: 16px; opacity: 0.5; }

    /* Side Panel */
    .side-panel { background: rgba(0, 0, 0, 0.2); border-left: 1px solid var(--border-subtle); padding: 24px; display: flex; flex-direction: column; gap: 20px; }
    .side-panel-title { font-size: 1.125rem; font-weight: 600; margin-bottom: 8px; }
    .skills-grid { display: grid; gap: 12px; }
    .skill-btn { display: flex; align-items: center; gap: 14px; padding: 16px 20px; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s ease; text-align: left; }
    .skill-btn:hover:not(:disabled) { background: var(--bg-card-hover); border-color: var(--border-active); transform: translateX(4px); }
    .skill-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .skill-btn.loading { border-color: var(--accent-primary); }
    .skill-icon { width: 44px; height: 44px; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; font-size: 1.25rem; flex-shrink: 0; }
    .skill-icon.inner-os { background: linear-gradient(135deg, #6366f1, #8b5cf6); }
    .skill-icon.brainstorm { background: linear-gradient(135deg, #f59e0b, #ef4444); }
    .skill-icon.stop-talking { background: linear-gradient(135deg, #ec4899, #8b5cf6); }
    .skill-info { flex: 1; }
    .skill-name { font-weight: 600; color: var(--text-primary); margin-bottom: 2px; }
    .skill-desc { font-size: 0.75rem; color: var(--text-muted); }
    .skill-status { font-size: 0.875rem; }

    /* Auto Push */
    .auto-push-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 20px; }
    .auto-push-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .auto-push-title { font-weight: 600; }
    .toggle-switch { position: relative; width: 52px; height: 28px; background: rgba(255, 255, 255, 0.1); border-radius: 100px; cursor: pointer; transition: background 0.3s ease; }
    .toggle-switch.active { background: var(--accent-primary); }
    .toggle-switch::after { content: ''; position: absolute; top: 3px; left: 3px; width: 22px; height: 22px; background: white; border-radius: 50%; transition: transform 0.3s ease; }
    .toggle-switch.active::after { transform: translateX(24px); }
    .auto-push-desc { font-size: 0.75rem; color: var(--text-muted); }

    /* QA Section */
    .qa-section { flex: 1; display: flex; flex-direction: column; background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); overflow: hidden; min-height: 200px; }
    .qa-messages { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 12px; }
    .qa-message { max-width: 85%; padding: 12px 16px; border-radius: var(--radius-md); font-size: 0.875rem; line-height: 1.5; }
    .qa-message.user { align-self: flex-end; background: var(--accent-primary); color: white; border-bottom-right-radius: 4px; }
    .qa-message.assistant { align-self: flex-start; background: rgba(255, 255, 255, 0.05); color: var(--text-primary); border-bottom-left-radius: 4px; }
    .qa-input-container { display: flex; gap: 10px; padding: 16px; border-top: 1px solid var(--border-subtle); }
    .qa-input { flex: 1; padding: 12px 16px; background: rgba(0, 0, 0, 0.2); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-size: 0.875rem; outline: none; transition: border-color 0.2s ease; }
    .qa-input:focus { border-color: var(--accent-primary); }
    .qa-input::placeholder { color: var(--text-muted); }
    .qa-send-btn { padding: 12px 20px; background: var(--accent-primary); border: none; border-radius: var(--radius-md); color: white; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
    .qa-send-btn:hover { background: var(--accent-secondary); }
    .qa-send-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    /* Visualization Card (V2) */
    .visualization-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); padding: 20px; margin-bottom: 20px; }
    .visualization-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .visualization-title { font-weight: 600; font-size: 1.125rem; }
    .visualization-badge { padding: 4px 10px; background: var(--accent-secondary); border-radius: 100px; font-size: 0.75rem; font-weight: 600; }
    .visualization-type-selector { display: flex; gap: 8px; margin-bottom: 12px; }
    .vis-type-btn { flex: 1; padding: 10px 12px; background: rgba(0, 0, 0, 0.2); border: 1px solid var(--border-subtle); border-radius: var(--radius-sm); color: var(--text-secondary); font-size: 0.875rem; cursor: pointer; transition: all 0.2s ease; }
    .vis-type-btn:hover { background: var(--bg-card-hover); border-color: var(--border-active); }
    .vis-type-btn.active { background: var(--accent-primary); color: white; border-color: var(--accent-primary); }
    .chart-type-selector { margin-bottom: 12px; }
    .chart-type-select { width: 100%; padding: 10px 12px; background: rgba(0, 0, 0, 0.2); border: 1px solid var(--border-subtle); border-radius: var(--radius-sm); color: var(--text-primary); font-size: 0.875rem; outline: none; }
    .vis-generate-btn { width: 100%; padding: 14px 20px; background: var(--gradient-hero); border: none; border-radius: var(--radius-md); color: white; font-weight: 600; font-size: 0.9375rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .vis-generate-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: var(--shadow-glow); }
    .vis-generate-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .vis-status { margin-top: 12px; padding: 12px; background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: var(--radius-sm); font-size: 0.875rem; color: var(--accent-primary); }
    .vis-status-error { color: var(--error); border-color: rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.1); }
    .visualization-item { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 20px; margin-bottom: 16px; }
    .visualization-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .visualization-item-type { padding: 4px 10px; background: var(--bg-card-hover); border-radius: 100px; font-size: 0.75rem; color: var(--text-secondary); }
    .visualization-item-actions { display: flex; gap: 8px; }
    .vis-action-btn { padding: 6px 12px; background: rgba(0, 0, 0, 0.2); border: 1px solid var(--border-subtle); border-radius: var(--radius-sm); color: var(--text-secondary); font-size: 0.75rem; cursor: pointer; transition: all 0.2s ease; }
    .vis-action-btn:hover { background: var(--bg-card-hover); border-color: var(--border-active); }
    .visualization-image { width: 100%; border-radius: var(--radius-md); margin-bottom: 12px; cursor: pointer; transition: transform 0.2s ease; }
    .visualization-image:hover { transform: scale(1.02); }
    .visualization-metadata { font-size: 0.75rem; color: var(--text-muted); }
    .vis-modal { display: none; position: fixed; inset: 0; z-index: 1000; background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(10px); align-items: center; justify-content: center; padding: 40px; }
    .vis-modal.show { display: flex; }
    .vis-modal-content { max-width: 90vw; max-height: 90vh; position: relative; }
    .vis-modal-image { width: 100%; height: auto; border-radius: var(--radius-lg); }
    .vis-modal-close { position: absolute; top: -40px; right: 0; padding: 8px 16px; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--border-subtle); border-radius: var(--radius-sm); color: var(--text-primary); cursor: pointer; }

    /* Config Section */
    .config-section { padding: 100px 0; }
    .config-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); overflow: hidden; }
    .config-header { padding: 24px 32px; border-bottom: 1px solid var(--border-subtle); display: flex; align-items: center; justify-content: space-between; }
    .config-title { font-size: 1.25rem; font-weight: 600; }
    .config-status { display: flex; align-items: center; gap: 8px; font-size: 0.875rem; }
    .config-body { padding: 32px; }
    .config-group { margin-bottom: 24px; }
    .config-group:last-child { margin-bottom: 0; }
    .config-label { display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-secondary); margin-bottom: 8px; }
    .config-input { width: 100%; padding: 14px 18px; background: rgba(0, 0, 0, 0.2); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); color: var(--text-primary); font-size: 0.9375rem; font-family: 'SF Mono', 'Fira Code', monospace; outline: none; transition: border-color 0.2s ease; }
    .config-input:focus { border-color: var(--accent-primary); }
    .config-input::placeholder { color: var(--text-muted); }
    .config-hint { font-size: 0.75rem; color: var(--text-muted); margin-top: 8px; }
    .config-hint a { color: var(--accent-primary); text-decoration: none; }
    .config-hint a:hover { text-decoration: underline; }
    .config-actions { display: flex; gap: 12px; margin-top: 32px; }

    /* Features */
    .features-section { padding: 100px 0; }
    .features-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 32px; }
    @media (max-width: 1024px) { .features-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 640px) { .features-grid { grid-template-columns: 1fr; } }
    .feature-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: var(--radius-lg); padding: 32px; transition: all 0.3s ease; }
    .feature-card:hover { transform: translateY(-8px); border-color: var(--border-active); }
    .feature-icon { width: 56px; height: 56px; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; font-size: 1.75rem; margin-bottom: 20px; background: var(--gradient-hero); }
    .feature-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 12px; }
    .feature-desc { color: var(--text-secondary); font-size: 0.9375rem; line-height: 1.7; }

    /* Footer */
    .footer { padding: 60px 0; border-top: 1px solid var(--border-subtle); text-align: center; }
    .footer-text { color: var(--text-muted); font-size: 0.875rem; }
    .footer-text a { color: var(--accent-primary); text-decoration: none; }

    /* Toast */
    .toast-container { position: fixed; bottom: 24px; right: 24px; z-index: 1000; display: flex; flex-direction: column; gap: 12px; }
    .toast { padding: 16px 24px; background: var(--bg-secondary); border: 1px solid var(--border-subtle); border-radius: var(--radius-md); box-shadow: var(--shadow-card); display: flex; align-items: center; gap: 12px; animation: slideIn 0.3s ease; max-width: 400px; }
    .toast.success { border-left: 3px solid var(--success); }
    .toast.error { border-left: 3px solid var(--error); }
    .toast.info { border-left: 3px solid var(--accent-primary); }
    .toast.warning { border-left: 3px solid var(--warning); }
    @keyframes slideIn { from { opacity: 0; transform: translateX(100px); } to { opacity: 1; transform: translateX(0); } }

    .spinner { width: 20px; height: 20px; border: 2px solid rgba(255, 255, 255, 0.2); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.2); }
  </style>
</head>
<body>
  <div class="ambient-bg">
    <div class="ambient-orb orb-1"></div>
    <div class="ambient-orb orb-2"></div>
    <div class="ambient-orb orb-3"></div>
  </div>

  <nav class="nav" id="nav">
    <div class="nav-inner">
      <div class="logo">
        <div class="logo-icon">ğŸ“¸</div>
        <span>ä¼šè®®å¿«ç…§</span>
      </div>
      <div class="nav-links">
        <a href="#demo" class="nav-link">Demo</a>
        <a href="#features" class="nav-link">åŠŸèƒ½</a>
        <a href="#config" class="nav-link">é…ç½®</a>
      </div>
      <button class="nav-cta" onclick="scrollToDemo()">å¼€å§‹ä½“éªŒ</button>
    </div>
  </nav>

  <section class="hero">
    <div class="hero-badge">
      <span class="hero-badge-dot"></span>
      <span>AI é©±åŠ¨ Â· å®æ—¶æ´å¯Ÿ</span>
    </div>
    <h1 class="hero-title">
      è®©æ¯ä¸€æ¬¡ä¼šè®®<br>
      <span class="hero-title-gradient">éƒ½æœ‰æ¸…æ™°å¤ç›˜</span>
    </h1>
    <p class="hero-subtitle">
      åŸºäºé€šä¹‰å¬æ‚Ÿ + Qwen3-Max çš„æ™ºèƒ½ä¼šè®®åŠ©æ‰‹ï¼Œå®æ—¶è½¬å†™ã€æ·±åº¦åˆ†æã€ä¸€é”®æ´å¯Ÿ
    </p>
    <div class="hero-actions">
      <button class="btn btn-primary" onclick="scrollToDemo()">
        <span>ğŸ™ï¸</span>
        <span>ç«‹å³ä½“éªŒ</span>
      </button>
      <a href="#features" class="btn btn-secondary">
        <span>äº†è§£æ›´å¤š</span>
        <span>â†’</span>
      </a>
    </div>
  </section>

  <section class="demo-section" id="demo">
    <div class="container">
      <div class="section-header">
        <span class="section-label">Live Demo</span>
        <h2 class="section-title">å®æ—¶æ¼”ç¤º</h2>
        <p class="section-desc">ä½“éªŒå®Œæ•´çš„ä¼šè®®å¿«ç…§åŠŸèƒ½ï¼Œä»å½•éŸ³åˆ° AI åˆ†æä¸€æ°”å‘µæˆ</p>
      </div>

      <!-- Alert Banner -->
      <div class="alert-banner" id="alertBanner">
        <div class="alert-banner-title">
          <span>âš ï¸</span>
          <span id="alertTitle">éœ€è¦å¯åŠ¨åç«¯æœåŠ¡</span>
        </div>
        <div class="alert-banner-content" id="alertContent">
          è¯·å…ˆå¯åŠ¨åç«¯æœåŠ¡ï¼š<br><br>
          <code>cd backend && npm run start:dev</code><br><br>
          æœåŠ¡å¯åŠ¨åï¼Œåˆ·æ–°æ­¤é¡µé¢æˆ–ç‚¹å‡»ä¸‹æ–¹"æµ‹è¯•è¿æ¥"æŒ‰é’®ã€‚
        </div>
      </div>

      <div class="demo-container">
        <div class="demo-toolbar">
          <div class="demo-toolbar-dots">
            <div class="demo-toolbar-dot dot-red"></div>
            <div class="demo-toolbar-dot dot-yellow"></div>
            <div class="demo-toolbar-dot dot-green"></div>
          </div>
          <div class="demo-toolbar-title">Meeting Snapshot v1.0</div>
          <div class="demo-toolbar-status">
            <div class="status-indicator" id="connectionStatus"></div>
            <span id="connectionText">æ£€æµ‹ä¸­...</span>
          </div>
        </div>

        <div class="demo-content">
          <div class="main-panel">
            <div class="recording-card">
              <div class="recording-header">
                <h3 class="recording-title">ä¼šè®®å½•åˆ¶</h3>
                <div class="recording-status idle" id="recordingStatus">
                  <span>â—</span>
                  <span id="recordingStatusText">å‡†å¤‡å°±ç»ª</span>
                </div>
              </div>
              <div class="recording-timer" id="recordingTimer">00:00</div>
              <div class="recording-hint" id="recordingHint">ç‚¹å‡»å¼€å§‹å½•éŸ³ï¼Œå®æ—¶è½¬å†™ä¼šè®®å†…å®¹</div>
              
              <div class="waveform-container">
                <div class="waveform" id="waveform"></div>
              </div>

              <div class="recording-controls">
                <button class="record-btn record-btn-secondary" id="pauseBtn" disabled>æš‚åœ</button>
                <button class="record-btn record-btn-primary" id="recordBtn" disabled>
                  <span>ğŸ™ï¸</span>
                  <span id="recordBtnText">å¼€å§‹å½•éŸ³</span>
                </button>
              </div>
            </div>

            <div class="upload-card">
              <div class="upload-header">
                <div>
                  <h4 class="upload-title">æ–‡ä»¶è½¬å†™æµ‹è¯•</h4>
                  <p class="upload-hint">ç›´æ¥ä¸Šä¼  mp3/wav/m4a/webmï¼Œç”±åç«¯è½¬ç æ¨æµåˆ°å¬æ‚Ÿ</p>
                </div>
                <span class="upload-status" id="uploadStatus">å¾…ä¸Šä¼ </span>
              </div>
              <div class="upload-actions">
                <input type="file" id="uploadInput" accept="audio/*" class="upload-input" />
                <input type="text" id="meetingIdInput" class="upload-meeting" placeholder="å¯é€‰ï¼šmeetingIdï¼ˆä¸å¡«è‡ªåŠ¨ç”Ÿæˆï¼‰" />
                <button class="record-btn record-btn-primary" id="uploadBtn">
                  <span>â¬†ï¸</span>
                  <span>ä¸Šä¼ å¹¶è½¬å†™</span>
                </button>
              </div>
            </div>

            <div class="transcription-panel">
              <div class="panel-header">
                <div class="panel-tabs">
                  <button class="panel-tab active" data-tab="transcription">å®æ—¶è½¬å†™</button>
                  <button class="panel-tab" data-tab="summary">AI æ€»ç»“</button>
                </div>
              </div>
              <div class="panel-content" id="panelContent">
                <div class="empty-state" id="emptyState">
                  <div class="empty-state-icon">ğŸ¤</div>
                  <p>å¼€å§‹å½•éŸ³åï¼Œè½¬å†™å†…å®¹å°†å®æ—¶æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                </div>
                <div id="transcriptionList" style="display: none;"></div>
                <div id="summaryList" style="display: none;">
                  <div id="visualizationList"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="side-panel">
            <div>
              <h4 class="side-panel-title">AI æŠ€èƒ½</h4>
              <div class="skills-grid">
                <button class="skill-btn" id="skillInnerOS" onclick="triggerSkill('inner_os')" disabled>
                  <div class="skill-icon inner-os">ğŸ§ </div>
                  <div class="skill-info">
                    <div class="skill-name">å†…å¿ƒ OS</div>
                    <div class="skill-desc">æ´å¯Ÿä¼šè®®æ½œå°è¯</div>
                  </div>
                  <span class="skill-status" id="skillInnerOSStatus"></span>
                </button>
                <button class="skill-btn" id="skillBrainstorm" onclick="triggerSkill('brainstorm')" disabled>
                  <div class="skill-icon brainstorm">ğŸ’¡</div>
                  <div class="skill-info">
                    <div class="skill-name">å¤´è„‘é£æš´</div>
                    <div class="skill-desc">ä¹”å¸ƒæ–¯å¼åˆ›æ„æ¿€å‘</div>
                  </div>
                  <span class="skill-status" id="skillBrainstormStatus"></span>
                </button>
                <button class="skill-btn" id="skillStopTalking" onclick="triggerSkill('stop_talking')" disabled>
                  <div class="skill-icon stop-talking">ğŸ›‘</div>
                  <div class="skill-info">
                    <div class="skill-name">åˆ«å†è¯´äº†</div>
                    <div class="skill-desc">çº åè·‘é¢˜è®¨è®º</div>
                  </div>
                  <span class="skill-status" id="skillStopTalkingStatus"></span>
                </button>
              </div>
            </div>

            <div class="auto-push-card">
              <div class="auto-push-header">
                <span class="auto-push-title">è‡ªåŠ¨æ¨é€åˆ†æ</span>
                <div class="toggle-switch" id="autoPushToggle" onclick="toggleAutoPush()"></div>
              </div>
              <p class="auto-push-desc">å¼€å¯åæ¯åˆ†é’Ÿè‡ªåŠ¨åˆ†æä¼šè®®çŠ¶æ€</p>
            </div>

            <!-- Visualization Card (V2) -->
            <div class="visualization-card">
              <div class="visualization-header">
                <h4 class="visualization-title">è§†è§‰åŒ–å…±è¯†</h4>
                <span class="visualization-badge">V2</span>
              </div>
              
              <div class="visualization-type-selector">
                <button class="vis-type-btn active" data-type="chart" onclick="selectVisualizationType('chart')">
                  ğŸ“Š ç§‘ç ”å›¾è¡¨
                </button>
                <button class="vis-type-btn" data-type="creative" onclick="selectVisualizationType('creative')">
                  ğŸ¨ åˆ›æ„å›¾åƒ
                </button>
                <button class="vis-type-btn" data-type="poster" onclick="selectVisualizationType('poster')">
                  ğŸ“‹ é€»è¾‘æµ·æŠ¥
                </button>
              </div>
              
              <div class="chart-type-selector" id="chartTypeSelector" style="display: none;">
                <select class="chart-type-select" id="chartTypeSelect" onchange="currentChartType = this.value">
                  <option value="radar">é›·è¾¾å›¾</option>
                  <option value="flowchart">æµç¨‹å›¾</option>
                  <option value="architecture">æ¶æ„å›¾</option>
                  <option value="bar">æŸ±çŠ¶å›¾</option>
                  <option value="line">æŠ˜çº¿å›¾</option>
                </select>
              </div>
              
              <button class="vis-generate-btn" id="visGenerateBtn" onclick="generateVisualization()" disabled>
                <span>âœ¨</span>
                <span>ç”Ÿæˆè§†è§‰åŒ–</span>
              </button>
              
              <div class="vis-status" id="visStatus" style="display: none;"></div>
              
              <!-- å›¾ç‰‡é¢„è§ˆåŒºåŸŸ -->
              <div class="vis-preview" id="visPreview" style="display: none; margin-top: 16px;">
                <div style="font-size: 0.875rem; color: var(--text-muted); margin-bottom: 8px;">ç”Ÿæˆç»“æœï¼š</div>
                <img id="visPreviewImage" src="" alt="è§†è§‰åŒ–é¢„è§ˆ" style="width: 100%; border-radius: var(--radius-md); cursor: pointer;" onclick="viewVisualizationFromPreview()">
                <div style="display: flex; gap: 8px; margin-top: 8px;">
                  <button class="vis-action-btn" onclick="downloadVisualizationFromPreview()">ä¸‹è½½</button>
                  <button class="vis-action-btn" onclick="shareVisualizationFromPreview()">åˆ†äº«</button>
                </div>
              </div>
            </div>

            <div class="qa-section">
              <div class="panel-header" style="padding: 16px;">
                <span style="font-weight: 600;">ä¼šè®®é—®ç­”</span>
              </div>
              <div class="qa-messages" id="qaMessages">
                <div class="qa-message assistant">
                  ğŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯ä¼šè®®åŠ©æ‰‹ï¼Œå¯ä»¥å›ç­”å…³äºå½“å‰ä¼šè®®å†…å®¹çš„ä»»ä½•é—®é¢˜ã€‚
                </div>
              </div>
              <div class="qa-input-container">
                <input type="text" class="qa-input" id="qaInput" placeholder="è¾“å…¥é—®é¢˜..." onkeypress="handleQAKeypress(event)">
                <button class="qa-send-btn" id="qaSendBtn" onclick="askQuestion()" disabled>å‘é€</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="features-section" id="features">
    <div class="container">
      <div class="section-header">
        <span class="section-label">Features</span>
        <h2 class="section-title">æ ¸å¿ƒåŠŸèƒ½</h2>
        <p class="section-desc">å¼ºå¤§çš„ AI èƒ½åŠ›ï¼Œè®©ä¼šè®®æ›´é«˜æ•ˆ</p>
      </div>
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">ğŸ™ï¸</div>
          <h3 class="feature-title">å®æ—¶è¯­éŸ³è½¬å†™</h3>
          <p class="feature-desc">åŸºäºé€šä¹‰å¬æ‚Ÿï¼Œæ¯«ç§’çº§å»¶è¿Ÿï¼Œæ”¯æŒä¸­è‹±æ–‡æ··åˆè¯†åˆ«ï¼Œå‡†ç¡®ç‡é«˜è¾¾ 98%</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">ğŸ§ </div>
          <h3 class="feature-title">æ·±åº¦è¯­ä¹‰åˆ†æ</h3>
          <p class="feature-desc">Qwen3-Max å¤§æ¨¡å‹é©±åŠ¨ï¼Œç†è§£ä¸Šä¸‹æ–‡è¯­ä¹‰ï¼Œæ´å¯Ÿä¼šè®®æ½œå°è¯</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">âš¡</div>
          <h3 class="feature-title">ä¸€é”®æŠ€èƒ½è§¦å‘</h3>
          <p class="feature-desc">å†…å¿ƒ OSã€å¤´è„‘é£æš´ã€çº åæé†’ï¼Œä¸‰å¤§æŠ€èƒ½éšæ—¶è°ƒç”¨</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">ğŸ”„</div>
          <h3 class="feature-title">è‡ªåŠ¨æ¨é€æ´å¯Ÿ</h3>
          <p class="feature-desc">æ¯åˆ†é’Ÿè‡ªåŠ¨åˆ†æä¼šè®®çŠ¶æ€ï¼Œä¸»åŠ¨æ¨é€å…³é”®ä¿¡æ¯å’Œç›²ç‚¹æé†’</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">ğŸ’¬</div>
          <h3 class="feature-title">æ™ºèƒ½é—®ç­”</h3>
          <p class="feature-desc">åŸºäºä¼šè®®å†…å®¹çš„è‡ªç”±é—®ç­”ï¼Œå¿«é€Ÿè·å–ç‰¹å®šä¿¡æ¯</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">ğŸ“±</div>
          <h3 class="feature-title">è·¨å¹³å°æ”¯æŒ</h3>
          <p class="feature-desc">Web + React Native åŒç«¯æ”¯æŒï¼Œéšæ—¶éšåœ°å‚ä¸ä¼šè®®</p>
        </div>
      </div>
    </div>
  </section>

  <section class="config-section" id="config">
    <div class="container">
      <div class="section-header">
        <span class="section-label">Configuration</span>
        <h2 class="section-title">æœåŠ¡é…ç½®</h2>
        <p class="section-desc">é…ç½®åç«¯æœåŠ¡åœ°å€</p>
      </div>
      <div class="config-card">
        <div class="config-header">
          <h3 class="config-title">è¿æ¥è®¾ç½®</h3>
          <div class="config-status">
            <div class="status-indicator" id="configStatus"></div>
            <span id="configStatusText">æœªè¿æ¥</span>
          </div>
        </div>
        <div class="config-body">
          <div class="config-group">
            <label class="config-label">åç«¯æœåŠ¡åœ°å€</label>
            <input type="text" class="config-input" id="apiBaseUrl" value="http://localhost:4000" placeholder="http://localhost:4000">
            <p class="config-hint">é»˜è®¤ä¸ºæœ¬åœ°å¼€å‘æœåŠ¡å™¨ (ç«¯å£ 4000)</p>
          </div>
          <div class="config-actions">
            <button class="btn btn-primary" onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
            <button class="btn btn-secondary" onclick="saveConfig()">ä¿å­˜é…ç½®</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="container">
      <p class="footer-text">
        Built with â¤ï¸ using <a href="#">é€šä¹‰å¬æ‚Ÿ</a> + <a href="#">Qwen3-Max</a> | Â© 2024 Meeting Snapshot
      </p>
    </div>
  </footer>

  <div class="toast-container" id="toastContainer"></div>

  <script>
    // ========== State ==========
    const state = {
      sessionId: null,
      taskId: null,
      isRecording: false,
      isPaused: false,
      isConnected: false,
      recordingStartTime: null,
      transcription: [],
      summaries: [],
      autoPushEnabled: false,
      activeTab: 'transcription',
      mediaRecorder: null,
      apiBaseUrl: localStorage.getItem('apiBaseUrl') || 'http://localhost:4000',
      currentVisualizationType: 'chart',
      currentChartType: 'radar',
    };

    // ========== DOM Elements ==========
    const $ = id => document.getElementById(id);
    const elements = {
      nav: $('nav'),
      connectionStatus: $('connectionStatus'),
      connectionText: $('connectionText'),
      recordingStatus: $('recordingStatus'),
      recordingStatusText: $('recordingStatusText'),
      recordingTimer: $('recordingTimer'),
      recordingHint: $('recordingHint'),
      waveform: $('waveform'),
      recordBtn: $('recordBtn'),
      recordBtnText: $('recordBtnText'),
      pauseBtn: $('pauseBtn'),
      emptyState: $('emptyState'),
      transcriptionList: $('transcriptionList'),
      summaryList: $('summaryList'),
      autoPushToggle: $('autoPushToggle'),
      qaMessages: $('qaMessages'),
      qaInput: $('qaInput'),
      qaSendBtn: $('qaSendBtn'),
      configStatus: $('configStatus'),
      configStatusText: $('configStatusText'),
      apiBaseUrl: $('apiBaseUrl'),
      toastContainer: $('toastContainer'),
      alertBanner: $('alertBanner'),
      alertTitle: $('alertTitle'),
      alertContent: $('alertContent'),
      uploadInput: $('uploadInput'),
      meetingIdInput: $('meetingIdInput'),
      uploadBtn: $('uploadBtn'),
      uploadStatus: $('uploadStatus'),
      visGenerateBtn: $('visGenerateBtn'),
      visStatus: $('visStatus'),
      chartTypeSelector: $('chartTypeSelector'),
      chartTypeSelect: $('chartTypeSelect'),
      visualizationList: $('visualizationList'),
    };

    // ========== Initialize ==========
    function init() {
      elements.apiBaseUrl.value = state.apiBaseUrl;
      setupNavScroll();
      setupTabs();
      setupWaveform();
      testConnection();
    }

    function setupNavScroll() {
      window.addEventListener('scroll', () => {
        elements.nav.classList.toggle('scrolled', window.scrollY > 50);
      });
    }

    function scrollToDemo() {
      $('demo').scrollIntoView({ behavior: 'smooth' });
    }

    function setupTabs() {
      document.querySelectorAll('.panel-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          state.activeTab = tab.dataset.tab;
          document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          updatePanelContent();
        });
      });
    }

    function updatePanelContent() {
      // æ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹ï¼šè½¬å†™å†…å®¹ã€AIæ€»ç»“ã€æˆ–è§†è§‰åŒ–å†…å®¹
      const hasTranscription = state.transcription.length > 0;
      const hasSummaries = state.summaries.length > 0;
      const hasVisualizations = elements.visualizationList && elements.visualizationList.children.length > 0;
      
      const hasContent = state.activeTab === 'transcription' 
        ? hasTranscription 
        : (hasSummaries || hasVisualizations);
      
      elements.emptyState.style.display = hasContent ? 'none' : 'flex';
      elements.transcriptionList.style.display = state.activeTab === 'transcription' && hasTranscription ? 'block' : 'none';
      elements.summaryList.style.display = state.activeTab === 'summary' ? 'block' : 'none';
    }

    // ========== Waveform ==========
    function setupWaveform() {
      for (let i = 0; i < 40; i++) {
        const bar = document.createElement('div');
        bar.className = 'waveform-bar';
        bar.style.height = '10%';
        elements.waveform.appendChild(bar);
      }
    }

    let waveformInterval = null;
    function startWaveformAnimation() {
      if (waveformInterval) return;
      waveformInterval = setInterval(() => {
        elements.waveform.querySelectorAll('.waveform-bar').forEach((bar, i) => {
          const h = 10 + Math.sin(Date.now() / 200 + i * 0.5) * 20 + (state.isRecording ? 30 : 0) + Math.random() * 10;
          bar.style.height = `${h}%`;
        });
      }, 100);
    }

    function stopWaveformAnimation() {
      if (waveformInterval) { clearInterval(waveformInterval); waveformInterval = null; }
      elements.waveform.querySelectorAll('.waveform-bar').forEach(bar => bar.style.height = '10%');
    }

    // ========== Connection ==========
    async function testConnection() {
      const baseUrl = elements.apiBaseUrl.value.trim();
      state.apiBaseUrl = baseUrl;
      
      updateConnectionStatus('testing');
      
      try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 5000);
        
        const response = await fetch(`${baseUrl}/sessions/health`, {
          method: 'GET',
          signal: controller.signal
        });
        
        clearTimeout(timeoutId);
        
        if (response.ok) {
          state.isConnected = true;
          updateConnectionStatus('connected');
          hideAlert();
          enableControls(true);
          showToast('åç«¯è¿æ¥æˆåŠŸï¼', 'success');
        } else {
          throw new Error(`HTTP ${response.status}`);
        }
      } catch (error) {
        state.isConnected = false;
        updateConnectionStatus('error');
        enableControls(false);
        
        if (error.name === 'AbortError') {
          showAlert('è¿æ¥è¶…æ—¶', 'æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡ï¼Œè¯·ç¡®ä¿ï¼š<br><br>1. åç«¯æœåŠ¡å·²å¯åŠ¨ï¼š<code>cd backend && npm run start:dev</code><br><br>2. æœåŠ¡åœ°å€æ­£ç¡®ï¼ˆé»˜è®¤ http://localhost:4000ï¼‰');
        } else if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
          showAlert('æ— æ³•è¿æ¥åç«¯æœåŠ¡', 'è¯·å…ˆå¯åŠ¨åç«¯æœåŠ¡ï¼š<br><br><code>cd backend && npm run start:dev</code><br><br>å¯åŠ¨ååˆ·æ–°é¡µé¢æˆ–ç‚¹å‡»"æµ‹è¯•è¿æ¥"æŒ‰é’®ã€‚<br><br><strong>æç¤ºï¼š</strong>å¦‚æœä½¿ç”¨ file:// åè®®æ‰“å¼€æ­¤é¡µé¢ï¼Œå¯èƒ½ä¼šé‡åˆ°è·¨åŸŸé—®é¢˜ã€‚å»ºè®®ä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨æ‰“å¼€ã€‚');
        } else {
          showAlert('è¿æ¥å¤±è´¥', `é”™è¯¯ä¿¡æ¯ï¼š${error.message}`);
        }
      }
    }

    function updateConnectionStatus(status) {
      const statusMap = {
        testing: { class: '', text: 'æ£€æµ‹ä¸­...' },
        connected: { class: 'connected', text: 'å·²è¿æ¥' },
        error: { class: 'error', text: 'æœªè¿æ¥' }
      };
      const s = statusMap[status] || statusMap.error;
      elements.connectionStatus.className = `status-indicator ${s.class}`;
      elements.connectionText.textContent = s.text;
      elements.configStatus.className = `status-indicator ${s.class}`;
      elements.configStatusText.textContent = s.text;
    }

    function enableControls(enabled) {
      elements.recordBtn.disabled = !enabled;
      $('skillInnerOS').disabled = !enabled;
      $('skillBrainstorm').disabled = !enabled;
      $('skillStopTalking').disabled = !enabled;
      elements.qaSendBtn.disabled = !enabled;
      if (elements.uploadBtn) elements.uploadBtn.disabled = !enabled;
      updateVisualizationButtonState();
    }

    function showAlert(title, content) {
      elements.alertTitle.textContent = title;
      elements.alertContent.innerHTML = content;
      elements.alertBanner.classList.add('show');
    }

    function hideAlert() {
      elements.alertBanner.classList.remove('show');
    }

    function saveConfig() {
      localStorage.setItem('apiBaseUrl', elements.apiBaseUrl.value.trim());
      state.apiBaseUrl = elements.apiBaseUrl.value.trim();
      showToast('é…ç½®å·²ä¿å­˜', 'success');
    }

    // ========== Recording ==========
    async function toggleRecording() {
      if (state.isRecording) {
        await stopRecording();
      } else {
        await startRecording();
      }
    }

    async function startRecording() {
      if (!state.isConnected) {
        showToast('è¯·å…ˆè¿æ¥åç«¯æœåŠ¡', 'error');
        return;
      }

      // æ£€æŸ¥æ˜¯å¦æ”¯æŒ mediaDevices API
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        showToast('å½“å‰ç¯å¢ƒä¸æ”¯æŒéº¦å…‹é£è®¿é—®', 'error');
        showAlert('ä¸æ”¯æŒéº¦å…‹é£', 
          'æ‚¨çš„æµè§ˆå™¨æˆ–å½“å‰ç¯å¢ƒä¸æ”¯æŒéº¦å…‹é£è®¿é—®ã€‚<br><br>' +
          '<strong>å¯èƒ½çš„åŸå› ï¼š</strong><br>' +
          '1. ä½¿ç”¨äº†é HTTPS è¿æ¥ï¼ˆé localhostï¼‰<br>' +
          '2. æµè§ˆå™¨ç‰ˆæœ¬è¿‡æ—§<br><br>' +
          '<strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br>' +
          'â€¢ è¯·ä½¿ç”¨ <code>http://localhost:3001</code> è®¿é—®<br>' +
          'â€¢ æˆ–ä½¿ç”¨ HTTPS éƒ¨ç½²'
        );
        return;
      }

      try {
        // æ¯æ¬¡å½•éŸ³éƒ½åˆ›å»ºå…¨æ–°ä¼šè¯ï¼Œé¿å…å¤ç”¨å·²å®Œæˆçš„ä»»åŠ¡
        showToast('æ­£åœ¨åˆ›å»ºä¼šè¯...', 'info');
        state.sessionId = null;
        state.taskId = null;
        state.transcription = [];
        state.summaries = [];
        renderTranscription();
        renderSummaries();
        updatePanelContent();

        const response = await apiCall('POST', '/sessions', { meetingId: `meeting-${Date.now()}` });
        state.sessionId = response.sessionId;
        state.taskId = response.taskId;
        showToast('ä¼šè¯åˆ›å»ºæˆåŠŸ', 'success');

        // Request microphone
        showToast('æ­£åœ¨è¯·æ±‚éº¦å…‹é£æƒé™...', 'info');
        const stream = await navigator.mediaDevices.getUserMedia({ 
          audio: { sampleRate: 16000, channelCount: 1, echoCancellation: true, noiseSuppression: true }
        });

        state.mediaRecorder = new MediaRecorder(stream, { mimeType: MediaRecorder.isTypeSupported('audio/webm;codecs=opus') ? 'audio/webm;codecs=opus' : 'audio/webm' });

        state.mediaRecorder.ondataavailable = async (event) => {
          if (event.data.size > 0 && state.sessionId) {
            try {
              const base64 = await blobToBase64(event.data);
              await apiCall('POST', `/sessions/${state.sessionId}/audio`, { chunk: base64 });
            } catch (e) { console.warn('Upload chunk failed:', e); }
          }
        };

        state.mediaRecorder.start(1000);
        state.isRecording = true;
        state.recordingStartTime = Date.now();
        
        updateRecordingUI();
        startWaveformAnimation();
        startTimerUpdate();
        startPolling();
        
        showToast('ğŸ™ï¸ å½•éŸ³å·²å¼€å§‹', 'success');
      } catch (error) {
        console.error('Start recording failed:', error);
        
        if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
          showToast('éº¦å…‹é£æƒé™è¢«æ‹’ç»ï¼Œè¯·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å…è®¸è®¿é—®éº¦å…‹é£', 'error');
          showAlert('éœ€è¦éº¦å…‹é£æƒé™', 'è¯·ç‚¹å‡»æµè§ˆå™¨åœ°å€æ å·¦ä¾§çš„é”å›¾æ ‡ï¼Œå…è®¸è®¿é—®éº¦å…‹é£åé‡è¯•ã€‚');
        } else if (error.name === 'NotFoundError') {
          showToast('æœªæ‰¾åˆ°éº¦å…‹é£è®¾å¤‡', 'error');
        } else {
          showToast('å½•éŸ³å¯åŠ¨å¤±è´¥: ' + error.message, 'error');
        }
      }
    }

    async function stopRecording() {
      if (state.mediaRecorder) {
        state.mediaRecorder.stop();
        state.mediaRecorder.stream.getTracks().forEach(track => track.stop());
        state.mediaRecorder = null;
      }

      state.isRecording = false;
      state.isPaused = false;
      
      stopWaveformAnimation();
      stopTimerUpdate();
      updateRecordingUI();

      if (state.sessionId) {
        try {
          showToast('æ­£åœ¨å¤„ç†éŸ³é¢‘å¹¶å‘é€åˆ°é€šä¹‰å¬æ‚Ÿ...', 'info');
          // å…ˆå¤„ç†éŸ³é¢‘å‘é€åˆ°é€šä¹‰å¬æ‚Ÿ
          await apiCall('POST', `/sessions/${state.sessionId}/process`);
          showToast('éŸ³é¢‘å¤„ç†å®Œæˆï¼Œæ­£åœ¨ç­‰å¾…è½¬å†™ç»“æœ...', 'success');
          
          // ç»§ç»­è½®è¯¢ä¸€æ®µæ—¶é—´ä»¥è·å–è½¬å†™ç»“æœ
          let pollCount = 0;
          const maxPolls = 30; // æœ€å¤šè½®è¯¢30æ¬¡ï¼ˆ30ç§’ï¼‰
          const pollForResults = async () => {
            if (pollCount >= maxPolls) {
              stopPolling();
              showToast('è½¬å†™å®Œæˆ', 'success');
              return;
            }
            pollCount++;
            await pollUpdates();
            setTimeout(pollForResults, 1000);
          };
          pollForResults();
          
        } catch (e) { 
          console.warn('Process audio failed:', e); 
          showToast('éŸ³é¢‘å¤„ç†å¤±è´¥: ' + e.message, 'error');
        }
        
        try {
          await apiCall('POST', `/sessions/${state.sessionId}/complete`);
        } catch (e) { console.warn('Complete session failed:', e); }
      }
    }

    function togglePause() {
      if (!state.isRecording) return;
      state.isPaused = !state.isPaused;
      if (state.isPaused) {
        state.mediaRecorder?.pause();
        stopWaveformAnimation();
      } else {
        state.mediaRecorder?.resume();
        startWaveformAnimation();
      }
      updateRecordingUI();
    }

    function updateRecordingUI() {
      if (state.isRecording) {
        elements.recordingStatus.className = 'recording-status recording';
        elements.recordingStatusText.textContent = state.isPaused ? 'å·²æš‚åœ' : 'å½•åˆ¶ä¸­';
        elements.recordBtnText.textContent = 'åœæ­¢å½•éŸ³';
        elements.recordBtn.classList.add('recording');
        elements.pauseBtn.disabled = false;
        elements.pauseBtn.textContent = state.isPaused ? 'ç»§ç»­' : 'æš‚åœ';
        elements.recordingHint.textContent = state.isPaused ? 'å½•éŸ³å·²æš‚åœ' : 'æ­£åœ¨å½•åˆ¶å¹¶å®æ—¶è½¬å†™...';
      } else {
        elements.recordingStatus.className = 'recording-status idle';
        elements.recordingStatusText.textContent = 'å‡†å¤‡å°±ç»ª';
        elements.recordBtnText.textContent = 'å¼€å§‹å½•éŸ³';
        elements.recordBtn.classList.remove('recording');
        elements.pauseBtn.disabled = true;
        elements.pauseBtn.textContent = 'æš‚åœ';
        elements.recordingHint.textContent = 'ç‚¹å‡»å¼€å§‹å½•éŸ³ï¼Œå®æ—¶è½¬å†™ä¼šè®®å†…å®¹';
      }
    }

    // ========== Timer ==========
    let timerInterval = null;
    function startTimerUpdate() {
      if (timerInterval) return;
      timerInterval = setInterval(() => {
        if (!state.recordingStartTime) return;
        const elapsed = Date.now() - state.recordingStartTime;
        const m = Math.floor(elapsed / 60000).toString().padStart(2, '0');
        const s = Math.floor((elapsed % 60000) / 1000).toString().padStart(2, '0');
        elements.recordingTimer.textContent = `${m}:${s}`;
      }, 1000);
    }

    function stopTimerUpdate() {
      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
    }

    // ========== Polling ==========
    let pollingInterval = null;
    function startPolling() {
      if (pollingInterval) return;
      pollUpdates(); // ç«‹å³æ‰§è¡Œä¸€æ¬¡
      pollingInterval = setInterval(pollUpdates, 2000); // æ”¹ä¸º 2 ç§’
    }

    function stopPolling() {
      if (pollingInterval) { clearInterval(pollingInterval); pollingInterval = null; }
    }

    async function pollUpdates() {
      if (!state.sessionId) return;
      try {
        const [transcripts, summaries] = await Promise.all([
          apiCall('GET', `/sessions/${state.sessionId}/transcripts`),
          apiCall('GET', `/sessions/${state.sessionId}/summaries`)
        ]);
        console.log('Poll result:', { transcripts, summaries }); // è°ƒè¯•æ—¥å¿—
        if (transcripts.transcription && transcripts.transcription.length > 0) { 
          state.transcription = transcripts.transcription; 
          renderTranscription(); 
          updateVisualizationButtonState();
        }
        if (summaries.summaries) { state.summaries = summaries.summaries; renderSummaries(); }
        
        // è½®è¯¢è§†è§‰åŒ–å†…å®¹ (V2)
        try {
          const visResponse = await apiCall('GET', `/sessions/${state.sessionId}/visualizations`);
          if (visResponse.visualizations && visResponse.visualizations.length > 0) {
            renderVisualizations(visResponse.visualizations);
          }
        } catch (e) {
          // å¿½ç•¥è§†è§‰åŒ–è½®è¯¢é”™è¯¯ï¼ˆå¯èƒ½APIè¿˜æœªå®ç°ï¼‰
        }
        
        updatePanelContent();
      } catch (e) { console.warn('Poll failed:', e); }
    }

    // ========== Render ==========
    function renderTranscription() {
      if (state.transcription.length === 0) {
        elements.transcriptionList.innerHTML = '<div class="empty-hint">ç­‰å¾…è½¬å†™ç»“æœ...</div>';
        return;
      }
      elements.transcriptionList.innerHTML = state.transcription.map(item => `
        <div class="transcript-item">
          <div class="transcript-time">${formatTime(item.startMs)}</div>
          <div class="transcript-text">${escapeHtml(item.text)}</div>
        </div>
      `).join('');
      elements.transcriptionList.scrollTop = elements.transcriptionList.scrollHeight;
    }

    function renderSummaries() {
      const colors = { inner_os: '#6366f1', brainstorm: '#f59e0b', stop_talking: '#ec4899', auto_analysis: '#10b981' };
      let html = state.summaries.map(card => `
        <div class="transcript-item" style="border-left-color: ${colors[card.type] || '#6366f1'}">
          <div class="transcript-time">${card.title || card.type}</div>
          <div class="transcript-text">${formatContent(card.content)}</div>
        </div>
      `).join('');
      
      // ä¿å­˜ç°æœ‰çš„è§†è§‰åŒ–å†…å®¹
      const existingVisContent = elements.visualizationList ? elements.visualizationList.innerHTML : '';
      
      // æ›´æ–° summaryList å†…å®¹ï¼Œä¿ç•™ visualizationList å®¹å™¨
      elements.summaryList.innerHTML = html + '<div id="visualizationList"></div>';
      elements.visualizationList = document.getElementById('visualizationList');
      
      // æ¢å¤è§†è§‰åŒ–å†…å®¹
      if (existingVisContent && elements.visualizationList) {
        elements.visualizationList.innerHTML = existingVisContent;
      }
    }

    function renderVisualizations(visualizations) {
      if (!elements.visualizationList) {
        const summaryList = document.getElementById('summaryList');
        if (summaryList) {
          const visList = document.createElement('div');
          visList.id = 'visualizationList';
          summaryList.appendChild(visList);
          elements.visualizationList = visList;
        }
      }
      
      if (!elements.visualizationList) return;
      
      // æ¸…é™¤ç°æœ‰å†…å®¹å¹¶é‡æ–°æ¸²æŸ“
      elements.visualizationList.innerHTML = '';
      
      const typeLabels = {
        chart: 'ç§‘ç ”å›¾è¡¨',
        creative: 'åˆ›æ„å›¾åƒ',
        poster: 'é€»è¾‘æµ·æŠ¥',
      };
      
      visualizations.forEach(result => {
        const card = document.createElement('div');
        card.className = 'visualization-item';
        card.dataset.visId = result.id;
        
        const imageSrc = result.imageUrl || (result.imageBase64 ? `data:${result.metadata?.mimeType || 'image/png'};base64,${result.imageBase64}` : '');
        
        card.innerHTML = `
          <div class="visualization-item-header">
            <span class="visualization-item-type">${typeLabels[result.type] || result.type}</span>
            <div class="visualization-item-actions">
              <button class="vis-action-btn" onclick="viewVisualization('${result.id}')">æŸ¥çœ‹</button>
              <button class="vis-action-btn" onclick="downloadVisualization('${result.id}')">ä¸‹è½½</button>
              <button class="vis-action-btn" onclick="shareVisualization('${result.id}')">åˆ†äº«</button>
            </div>
          </div>
          ${imageSrc ? `<img src="${imageSrc}" alt="è§†è§‰åŒ–å†…å®¹" class="visualization-image" onclick="viewVisualization('${result.id}')">` : ''}
          <div class="visualization-metadata">
            ç”Ÿæˆæ—¶é—´: ${new Date(result.createdAt).toLocaleString('zh-CN')}
          </div>
        `;
        
        elements.visualizationList.appendChild(card);
      });
    }

    function formatContent(content) {
      if (typeof content === 'string') return escapeHtml(content);
      if (Array.isArray(content)) return content.map(escapeHtml).join('<br>');
      if (typeof content === 'object') return Object.entries(content).map(([k, v]) => `<strong>${k}:</strong> ${escapeHtml(String(v))}`).join('<br>');
      return String(content);
    }

    // ========== Skills ==========
    async function triggerSkill(skill) {
      if (!state.sessionId) { showToast('è¯·å…ˆå¼€å§‹å½•éŸ³', 'error'); return; }

      const names = { inner_os: 'InnerOS', brainstorm: 'Brainstorm', stop_talking: 'StopTalking' };
      const displayNames = { inner_os: 'å†…å¿ƒ OS', brainstorm: 'å¤´è„‘é£æš´', stop_talking: 'åˆ«å†è¯´äº†' };
      const statusEl = $(`skill${names[skill]}Status`);
      const btnEl = $(`skill${names[skill]}`);
      
      btnEl.disabled = true;
      btnEl.classList.add('loading');
      statusEl.innerHTML = '<div class="spinner"></div>';

      try {
        const response = await apiCall('POST', `/sessions/${state.sessionId}/skills/${skill}`);
        if (response.cards?.length) {
          state.summaries = [...state.summaries, ...response.cards];
          renderSummaries();
          document.querySelector('[data-tab="summary"]').click();
        }
        statusEl.textContent = 'âœ“';
        showToast(`${displayNames[skill]} åˆ†æå®Œæˆ`, 'success');
      } catch (error) {
        statusEl.textContent = 'âš ï¸';
        showToast(`${displayNames[skill]} å¤±è´¥: ${error.message}`, 'error');
      } finally {
        btnEl.disabled = false;
        btnEl.classList.remove('loading');
        setTimeout(() => { statusEl.textContent = ''; }, 2000);
      }
    }

    // ========== Auto Push ==========
    async function toggleAutoPush() {
      if (!state.sessionId) { showToast('è¯·å…ˆå¼€å§‹å½•éŸ³', 'error'); return; }

      state.autoPushEnabled = !state.autoPushEnabled;
      elements.autoPushToggle.classList.toggle('active', state.autoPushEnabled);

      try {
        if (state.autoPushEnabled) {
          await apiCall('POST', `/sessions/${state.sessionId}/auto-push/start`);
          showToast('è‡ªåŠ¨æ¨é€å·²å¼€å¯', 'success');
        } else {
          await apiCall('POST', `/sessions/${state.sessionId}/auto-push/stop`);
          showToast('è‡ªåŠ¨æ¨é€å·²å…³é—­', 'info');
        }
      } catch (error) {
        state.autoPushEnabled = !state.autoPushEnabled;
        elements.autoPushToggle.classList.toggle('active', state.autoPushEnabled);
        showToast('åˆ‡æ¢å¤±è´¥: ' + error.message, 'error');
      }
    }

    // ========== File Upload ==========
    function setUploadStatus(text, status = 'idle') {
      elements.uploadStatus.textContent = text;
      elements.uploadStatus.className = `upload-status ${status}`;
    }

    async function uploadAndTranscribe() {
      if (!state.isConnected) { showToast('è¯·å…ˆè¿æ¥åç«¯æœåŠ¡', 'error'); return; }
      const file = elements.uploadInput.files?.[0];
      if (!file) { showToast('è¯·å…ˆé€‰æ‹©éŸ³é¢‘æ–‡ä»¶', 'warning'); return; }

      setUploadStatus('ä¸Šä¼ ä¸­...', 'loading');
      elements.uploadBtn.disabled = true;

      try {
        const form = new FormData();
        form.append('file', file);
        const meetingId = elements.meetingIdInput.value.trim();
        if (meetingId) form.append('meetingId', meetingId);

        const response = await fetch(`${state.apiBaseUrl}/sessions/upload`, {
          method: 'POST',
          body: form,
        });

        if (!response.ok) {
          const text = await response.text();
          throw new Error(text || `HTTP ${response.status}`);
        }

        const data = await response.json();
        state.sessionId = data.sessionId;
        state.taskId = data.taskId;
        state.transcription = [];
        state.summaries = [];
        state.isRecording = false;
        state.isPaused = false;
        renderTranscription();
        renderSummaries();
        updatePanelContent();
        stopPolling();
        startPolling();
        setUploadStatus('å·²ä¸Šä¼ ï¼Œè½¬å†™ä¸­', 'success');
        showToast('æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œå·²å¼€å§‹è½¬å†™', 'success');
      } catch (error) {
        console.error('Upload failed:', error);
        setUploadStatus('ä¸Šä¼ å¤±è´¥', 'error');
        showToast('ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
      } finally {
        elements.uploadBtn.disabled = false;
      }
    }

    // ========== QA ==========
    function handleQAKeypress(event) { if (event.key === 'Enter') askQuestion(); }

    async function askQuestion() {
      const question = elements.qaInput.value.trim();
      if (!question) return;
      if (!state.sessionId) { showToast('è¯·å…ˆå¼€å§‹å½•éŸ³', 'error'); return; }

      addQAMessage(question, 'user');
      elements.qaInput.value = '';
      elements.qaSendBtn.disabled = true;

      try {
        const response = await apiCall('POST', `/sessions/${state.sessionId}/qa`, { question });
        addQAMessage(response.answer, 'assistant');
      } catch (error) {
        addQAMessage('æŠ±æ­‰ï¼Œå¤„ç†é—®é¢˜æ—¶å‡ºé”™äº†: ' + error.message, 'assistant');
      } finally {
        elements.qaSendBtn.disabled = false;
      }
    }

    function addQAMessage(content, role) {
      const el = document.createElement('div');
      el.className = `qa-message ${role}`;
      el.textContent = content;
      elements.qaMessages.appendChild(el);
      elements.qaMessages.scrollTop = elements.qaMessages.scrollHeight;
    }

    // ========== API ==========
    async function apiCall(method, path, body = null) {
      const options = { method, headers: { 'Content-Type': 'application/json' } };
      if (body) options.body = JSON.stringify(body);
      
      const response = await fetch(`${state.apiBaseUrl}${path}`, options);
      if (!response.ok) {
        const error = await response.text();
        throw new Error(error || `HTTP ${response.status}`);
      }
      return response.json();
    }

    // ========== Utilities ==========
    function blobToBase64(blob) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result.split(',')[1]);
        reader.onerror = reject;
        reader.readAsDataURL(blob);
      });
    }

    function formatTime(ms) {
      const m = Math.floor(ms / 60000).toString().padStart(2, '0');
      const s = Math.floor((ms % 60000) / 1000).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function showToast(message, type = 'info') {
      const icons = { success: 'âœ“', error: 'âœ•', info: 'â„¹', warning: 'âš ' };
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `<span>${icons[type] || 'â„¹'}</span><span>${escapeHtml(message)}</span>`;
      elements.toastContainer.appendChild(toast);
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100px)';
        setTimeout(() => toast.remove(), 300);
      }, 4000);
    }

    // ========== Visualization (V2) ==========
    function selectVisualizationType(type) {
      state.currentVisualizationType = type;
      
      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      document.querySelectorAll('.vis-type-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.type === type) {
          btn.classList.add('active');
        }
      });
      
      // æ˜¾ç¤º/éšè—å›¾è¡¨ç±»å‹é€‰æ‹©å™¨
      if (type === 'chart') {
        elements.chartTypeSelector.style.display = 'block';
      } else {
        elements.chartTypeSelector.style.display = 'none';
      }
      
      // æ›´æ–°ç”ŸæˆæŒ‰é’®çŠ¶æ€
      updateVisualizationButtonState();
    }

    function updateVisualizationButtonState() {
      const hasSession = !!state.sessionId;
      const hasTranscription = state.transcription && state.transcription.length > 0;
      elements.visGenerateBtn.disabled = !hasSession || !hasTranscription;
    }

    async function generateVisualization() {
      if (!state.sessionId) {
        showToast('è¯·å…ˆå¼€å§‹å½•éŸ³æˆ–ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶', 'error');
        return;
      }
      
      const type = state.currentVisualizationType;
      const chartType = type === 'chart' ? state.currentChartType : undefined;
      
      console.log('[DEBUG] generateVisualization called:', { sessionId: state.sessionId, type, chartType });
      
      elements.visGenerateBtn.disabled = true;
      elements.visGenerateBtn.innerHTML = '<span>â³</span><span>ç”Ÿæˆä¸­...</span>';
      elements.visStatus.style.display = 'block';
      elements.visStatus.innerHTML = '<div class="vis-status-loading">æ­£åœ¨ç”Ÿæˆè§†è§‰åŒ–å†…å®¹ï¼Œè¯·ç¨å€™...</div>';
      elements.visStatus.className = 'vis-status';
      
      try {
        const response = await apiCall('POST', `/sessions/${state.sessionId}/visualization`, {
          type: type,
          chartType: chartType,
        });
        
        console.log('[DEBUG] Visualization API response:', response);
        console.log('[DEBUG] Response has imageBase64:', !!response.imageBase64);
        console.log('[DEBUG] Response has imageUrl:', !!response.imageUrl);
        console.log('[DEBUG] Response metadata:', response.metadata);
        
        // æ˜¾ç¤ºç»“æœ
        displayVisualization(response);
        
        // é‡ç½®æŒ‰é’®çŠ¶æ€
        elements.visGenerateBtn.disabled = false;
        elements.visGenerateBtn.innerHTML = '<span>âœ¨</span><span>ç”Ÿæˆè§†è§‰åŒ–</span>';
        elements.visStatus.style.display = 'none';
        showToast('è§†è§‰åŒ–å†…å®¹ç”ŸæˆæˆåŠŸï¼', 'success');
        
      } catch (error) {
        console.error('ç”Ÿæˆè§†è§‰åŒ–å¤±è´¥:', error);
        elements.visStatus.innerHTML = '<div class="vis-status-error">ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</div>';
        elements.visStatus.className = 'vis-status vis-status-error';
        elements.visGenerateBtn.disabled = false;
        elements.visGenerateBtn.innerHTML = '<span>âœ¨</span><span>ç”Ÿæˆè§†è§‰åŒ–</span>';
        showToast('ç”Ÿæˆå¤±è´¥: ' + error.message, 'error');
      }
    }

    function displayVisualization(result) {
      console.log('[DEBUG] displayVisualization called with result:', result);
      
      const typeLabels = {
        chart: 'ç§‘ç ”å›¾è¡¨',
        creative: 'åˆ›æ„å›¾åƒ',
        poster: 'é€»è¾‘æµ·æŠ¥',
      };
      
      const imageSrc = result.imageUrl || (result.imageBase64 ? `data:${result.metadata?.mimeType || 'image/png'};base64,${result.imageBase64}` : '');
      console.log('[DEBUG] Image source:', imageSrc ? `${imageSrc.substring(0, 100)}...` : 'EMPTY');
      
      // 1. åœ¨ä¾§è¾¹æ çš„é¢„è§ˆåŒºåŸŸæ˜¾ç¤ºå›¾ç‰‡ï¼ˆæœ€ç›´æ¥çš„å±•ç¤ºï¼‰
      const visPreview = document.getElementById('visPreview');
      const visPreviewImage = document.getElementById('visPreviewImage');
      if (visPreview && visPreviewImage && imageSrc) {
        visPreviewImage.src = imageSrc;
        visPreviewImage.dataset.visId = result.id;
        visPreview.style.display = 'block';
        console.log('[DEBUG] Image displayed in preview area');
      }
      
      // 2. åŒæ—¶åœ¨ AI æ€»ç»“ tab çš„ visualizationList ä¸­æ·»åŠ è®°å½•
      if (!elements.visualizationList) {
        const summaryList = document.getElementById('summaryList');
        if (summaryList) {
          const visList = document.createElement('div');
          visList.id = 'visualizationList';
          summaryList.appendChild(visList);
          elements.visualizationList = visList;
        }
      }
      
      if (elements.visualizationList) {
        const card = document.createElement('div');
        card.className = 'visualization-item';
        card.dataset.visId = result.id;
        
        card.innerHTML = `
          <div class="visualization-item-header">
            <span class="visualization-item-type">${typeLabels[result.type] || result.type}</span>
            <div class="visualization-item-actions">
              <button class="vis-action-btn" onclick="viewVisualization('${result.id}')">æŸ¥çœ‹</button>
              <button class="vis-action-btn" onclick="downloadVisualization('${result.id}')">ä¸‹è½½</button>
              <button class="vis-action-btn" onclick="shareVisualization('${result.id}')">åˆ†äº«</button>
            </div>
          </div>
          ${imageSrc ? `<img src="${imageSrc}" alt="è§†è§‰åŒ–å†…å®¹" class="visualization-image" onclick="viewVisualization('${result.id}')">` : '<div style="padding: 20px; color: var(--text-muted);">å›¾åƒæ•°æ®ä¸ºç©º</div>'}
          <div class="visualization-metadata">
            ç”Ÿæˆæ—¶é—´: ${new Date(result.createdAt).toLocaleString('zh-CN')}
          </div>
        `;
        
        elements.visualizationList.insertBefore(card, elements.visualizationList.firstChild);
      }
        
      // åˆ‡æ¢åˆ° summary tab å¹¶å¼ºåˆ¶æ˜¾ç¤º
      const summaryTab = document.querySelector('[data-tab="summary"]');
      if (summaryTab) {
        summaryTab.click();
      }
      
      // å¼ºåˆ¶æ˜¾ç¤º summaryListï¼ˆå³ä½¿æ²¡æœ‰ AI æ€»ç»“å†…å®¹ï¼‰
      elements.summaryList.style.display = 'block';
      elements.emptyState.style.display = 'none';
      
      console.log('[DEBUG] Visualization card added, summaryList display:', elements.summaryList.style.display);
    }
    
    // é¢„è§ˆåŒºåŸŸçš„è¾…åŠ©å‡½æ•°
    function viewVisualizationFromPreview() {
      const img = document.getElementById('visPreviewImage');
      if (!img || !img.src) return;
      
      let modal = document.getElementById('visModal');
      if (!modal) {
        modal = document.createElement('div');
        modal.id = 'visModal';
        modal.className = 'vis-modal';
        modal.innerHTML = `
          <div class="vis-modal-content">
            <button class="vis-modal-close" onclick="closeVisualizationModal()">å…³é—­</button>
            <img class="vis-modal-image" id="visModalImage" src="" alt="è§†è§‰åŒ–å†…å®¹">
          </div>
        `;
        document.body.appendChild(modal);
        modal.addEventListener('click', (e) => {
          if (e.target === modal) closeVisualizationModal();
        });
      }
      
      const modalImg = document.getElementById('visModalImage');
      if (modalImg) {
        modalImg.src = img.src;
        modal.classList.add('show');
      }
    }
    
    function downloadVisualizationFromPreview() {
      const img = document.getElementById('visPreviewImage');
      if (!img || !img.src) return;
      
      const link = document.createElement('a');
      link.href = img.src;
      link.download = `visualization-${Date.now()}.png`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      showToast('å›¾åƒä¸‹è½½æˆåŠŸ', 'success');
    }
    
    function shareVisualizationFromPreview() {
      const img = document.getElementById('visPreviewImage');
      if (!img || !img.src) return;
      
      if (navigator.share) {
        fetch(img.src)
          .then(res => res.blob())
          .then(blob => {
            const file = new File([blob], `visualization-${Date.now()}.png`, { type: 'image/png' });
            navigator.share({
              title: 'ä¼šè®®è§†è§‰åŒ–å†…å®¹',
              files: [file]
            }).then(() => {
              showToast('åˆ†äº«æˆåŠŸ', 'success');
            }).catch(() => {
              showToast('åˆ†äº«å–æ¶ˆ', 'info');
            });
          });
      } else {
        navigator.clipboard.writeText(img.src).then(() => {
          showToast('å›¾ç‰‡é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        }).catch(() => {
          showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨ä¿å­˜å›¾ç‰‡', 'error');
        });
      }
    }

    function viewVisualization(visId) {
      const card = document.querySelector(`[data-vis-id="${visId}"]`);
      if (!card) return;
      
      const img = card.querySelector('.visualization-image');
      if (!img) return;
      
      // åˆ›å»ºæ¨¡æ€æ¡†
      let modal = document.getElementById('visModal');
      if (!modal) {
        modal = document.createElement('div');
        modal.id = 'visModal';
        modal.className = 'vis-modal';
        modal.innerHTML = `
          <div class="vis-modal-content">
            <button class="vis-modal-close" onclick="closeVisualizationModal()">å…³é—­</button>
            <img class="vis-modal-image" id="visModalImage" src="" alt="è§†è§‰åŒ–å†…å®¹">
          </div>
        `;
        document.body.appendChild(modal);
        modal.addEventListener('click', (e) => {
          if (e.target === modal) closeVisualizationModal();
        });
      }
      
      const modalImg = document.getElementById('visModalImage');
      if (modalImg) {
        modalImg.src = img.src;
        modal.classList.add('show');
      }
    }

    function closeVisualizationModal() {
      const modal = document.getElementById('visModal');
      if (modal) modal.classList.remove('show');
    }

    function downloadVisualization(visId) {
      const card = document.querySelector(`[data-vis-id="${visId}"]`);
      if (!card) return;
      
      const img = card.querySelector('.visualization-image');
      if (!img || !img.src) return;
      
      const link = document.createElement('a');
      link.href = img.src;
      link.download = `visualization-${visId}.png`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      showToast('å›¾åƒä¸‹è½½æˆåŠŸ', 'success');
    }

    function shareVisualization(visId) {
      const card = document.querySelector(`[data-vis-id="${visId}"]`);
      if (!card) return;
      
      const img = card.querySelector('.visualization-image');
      if (!img || !img.src) return;
      
      if (navigator.share) {
        fetch(img.src)
          .then(res => res.blob())
          .then(blob => {
            const file = new File([blob], `visualization-${visId}.png`, { type: 'image/png' });
            navigator.share({
              title: 'ä¼šè®®è§†è§‰åŒ–å†…å®¹',
              files: [file]
            }).then(() => {
              showToast('åˆ†äº«æˆåŠŸ', 'success');
            }).catch(() => {
              showToast('åˆ†äº«å–æ¶ˆ', 'info');
            });
          });
      } else {
        // é™çº§æ–¹æ¡ˆï¼šå¤åˆ¶å›¾ç‰‡URL
        navigator.clipboard.writeText(img.src).then(() => {
          showToast('å›¾ç‰‡é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        }).catch(() => {
          showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨ä¿å­˜å›¾ç‰‡', 'error');
        });
      }
    }

    // ç›‘å¬å›¾è¡¨ç±»å‹å˜åŒ–
    if (elements.chartTypeSelect) {
      elements.chartTypeSelect.addEventListener('change', function() {
        state.currentChartType = this.value;
      });
    }

    // Event bindings
    elements.recordBtn.addEventListener('click', toggleRecording);
    elements.pauseBtn.addEventListener('click', togglePause);
    elements.uploadBtn.addEventListener('click', uploadAndTranscribe);
    elements.uploadInput.addEventListener('change', () => {
      const file = elements.uploadInput.files?.[0];
      if (file) setUploadStatus(file.name);
    });
    
    // åˆå§‹åŒ–è§†è§‰åŒ–åŠŸèƒ½
    if (elements.chartTypeSelect) {
      elements.chartTypeSelect.addEventListener('change', function() {
        state.currentChartType = this.value;
      });
    }

    // Initialize
    init();
  </script>
</body>
</html>
