# 需求文档: 会议快照 V2 - 视觉化共识

## 介绍

本需求文档定义会议快照 V2 版本的功能迭代。产品定位为 **AI原生组织的信息管理工具**，从组织协作场景切入，提供实时会议转写、智能分析、主动推送等能力。

V2 版本在 V1 版本的基础上，新增**视觉化共识**功能，将抽象的会议讨论转化为具象的视觉产出，解决"沟通理解偏差"的痛点，并利于在社交媒体或组织内部传播。

## 已实现功能（V1）

- **实时转写**：音频流实时切分为5秒片段，通过通义听悟进行转写
- **文本流存储**：语音转文本内容持续追加到文本流中，成为上下文
- **用户主动触发技能**：内心OS、头脑风暴、别再说了（纠偏功能）
- **模型自动推送**：智能体每隔1分钟自动巡检会议状态，执行意图识别、内心OS、专家视角、纠偏提醒
- **自由问答**：用户可以随时根据当前会议上下文进行自由提问

---

## 需求

### 需求 1 - 视觉化共识生成

**用户故事：** 作为用户，我希望系统能够根据会议上下文实时生成图像、科研图表或逻辑海报，将抽象的讨论转化为具象的视觉产出，便于理解和传播。

#### 验收标准

1. When 用户触发"生成视觉化"功能时，the 系统 shall 基于当前会议文本流上下文，调用 Nano Banana Pro 模型生成视觉化内容。
2. When 生成视觉化内容时，the 系统 shall 支持以下类型：
   - **科研图表**：雷达图、流程图、架构图等结构化数据可视化
   - **创意图像**：会议情绪、核心愿景的精美海报
   - **逻辑海报**：会议要点、决策树、思维导图等逻辑可视化
3. When 生成结构化图表时，the 系统 shall 先将会议文本转化为结构化的绘图指令（例如：生成雷达图的数据维度、流程图的节点逻辑）。
4. When 生成创意图像时，the 系统 shall 将当前会议的情绪或核心愿景转化为精美的图像描述符（Prompt），生成具有传播价值的"会议快照"海报。
5. When 视觉化内容生成完成时，the 系统 shall 将生成的图像URL或Base64数据返回给前端。
6. When 视觉化内容生成完成时，the 系统 shall 将生成记录保存到消息流中，供后续查看和分享。

---

### 需求 2 - 结构化数据提取

**用户故事：** 作为系统，我需要从混乱的会议文本中提取结构化数据，以便生成准确的科研图表。

#### 验收标准

1. When 用户选择生成科研图表类型时，the 系统 shall 使用 LLM（Qwen3-Max）分析会议文本，提取结构化数据。
2. When 提取结构化数据时，the 系统 shall 根据图表类型提取相应数据：
   - **雷达图**：提取多个维度的数值或评分
   - **流程图**：提取流程节点、连接关系、决策点
   - **架构图**：提取系统组件、层级关系、依赖关系
   - **柱状图/折线图**：提取时间序列数据或分类数据
3. When 提取完成后，the 系统 shall 将结构化数据转换为 Nano Banana Pro 可理解的绘图指令格式。
4. When 数据提取失败时，the 系统 shall 返回友好的错误提示，建议用户重新选择或调整会议内容。

---

### 需求 3 - 创意图像描述生成

**用户故事：** 作为系统，我需要将会议的情绪、愿景或核心观点转化为高质量的图像生成提示词。

#### 验收标准

1. When 用户选择生成创意图像类型时，the 系统 shall 使用 LLM（Qwen3-Max）分析会议文本，提取核心情绪、愿景或关键观点。
2. When 生成图像描述时，the 系统 shall 生成符合 Nano Banana Pro 模型要求的详细 Prompt，包含：
   - 图像风格（如：现代商务、科技感、创意插画等）
   - 核心元素（如：会议主题、关键概念、视觉隐喻）
   - 色彩方案（如：温暖色调、冷色调、高对比度等）
   - 构图要求（如：居中、对称、动态等）
3. When 生成完成后，the 系统 shall 将图像描述发送给 Nano Banana Pro 模型进行图像生成。
4. When 图像生成失败时，the 系统 shall 提供降级方案（如：使用默认模板或重新生成描述）。

---

### 需求 4 - 视觉化内容管理

**用户故事：** 作为用户，我希望能够查看、分享和管理已生成的视觉化内容。

#### 验收标准

1. When 用户查看会话消息流时，the 系统 shall 展示已生成的视觉化内容（图像预览）。
2. When 用户点击视觉化内容时，the 系统 shall 提供查看大图、下载、分享等功能。
3. When 用户分享视觉化内容时，the 系统 shall 支持分享到社交媒体或组织内部平台。
4. When 会话结束时，the 系统 shall 持久化保存所有视觉化内容的元数据（生成时间、类型、描述等）。

---

## 技术约束

- **图像生成模型**：Nano Banana Pro（需确认具体API调用方式）
- **文本分析模型**：Qwen3-Max（复用V1已有实现）
- **图像存储**：支持URL或Base64格式（根据Nano Banana Pro返回格式决定）
- **生成触发方式**：用户主动触发（后续可扩展为自动生成）
- **生成类型**：科研图表、创意图像、逻辑海报（三种类型）

---

## 附录：Nano Banana Pro 模型说明

### 模型信息

| 属性 | 说明 |
|------|------|
| 模型名称 | `nano-banana-pro`（待确认） |
| 模型类型 | 图像生成模型（文生图） |
| 特色能力 | 科研图表生成、逻辑可视化、创意海报 |
| API 调用方式 | 待确认（需参考阿里云百炼控制台文档） |

### API 调用方式（待确认）

根据用户提供的参考文档链接：https://bailian.console.aliyun.com/?spm=5176.30371578.nav-v2-dropdown-menu-0.d_main_1_0_3.1659154aWHpBjT&tab=api&scm=20140722.M_10904477._.V_1#/api

需要在实施阶段确认：
- API 端点地址
- 认证方式（是否复用 DASHSCOPE_API_KEY）
- 请求参数格式
- 响应格式（图像URL或Base64）
- 支持的图像尺寸和格式

### 关键参数（待确认）

| 参数 | 类型 | 必选 | 说明 |
|------|------|------|------|
| `model` | string | 是 | 模型名称 |
| `prompt` | string | 是 | 图像生成提示词 |
| `size` | string | 否 | 图像尺寸（如：1024x1024） |
| `format` | string | 否 | 图像格式（如：png、jpg） |
| `quality` | string | 否 | 图像质量（如：standard、hd） |

---

## 与 V1 的关系

V2 版本在 V1 的基础上新增视觉化功能，**完全保持V1功能不变**，仅做扩展：

### V1 已有功能（保持不变）
- **前端页面**：`demo_show/index.html` 中的所有V1功能
  - 实时录音和转写
  - 技能按钮（内心OS、头脑风暴、别再说了）
  - 自动推送分析
  - 自由问答
- **后端模块**：
  - 文本流存储（ContextStore）
  - LLM 适配器（LLMAdapterService）
  - 技能服务（SkillService）
  - 自动推送服务（AutoPushService）
  - 会话管理（SessionService）

### V2 新增功能
- **前端扩展**：在 `demo_show/index.html` 中新增视觉化相关UI组件
  - 视觉化类型选择器（科研图表/创意图像/逻辑海报）
  - 图表类型选择器（雷达图/流程图/架构图等）
  - 生成按钮和状态显示
  - 视觉化结果展示区域
  - 图像查看、下载、分享功能
- **后端新增模块**：
  - 视觉化服务（VisualizationService）
  - 结构化数据提取服务（DataExtractionService）
  - 图像生成适配器（ImageGenerationAdapter）

### 兼容性保证
- V1的所有API接口保持不变
- V1的前端功能代码不修改，仅新增V2相关代码
- V2测试时，V1功能必须完全正常工作

